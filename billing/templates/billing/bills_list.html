{% extends "base.html" %}
{% block navbar %}
  {% include "partials/navbar.html" %}
{% endblock %}

{% block content %}

<h1 style="color:#0A1F44; margin-bottom:20px;">All Bills</h1>

<style>
  .card {
    padding: 20px;
    background: #F9F6F1;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    overflow-x: auto;
  }

  .filter-form {
    margin-bottom: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
  }
  .filter-form select,
  .filter-form input {
    padding: 8px;
    border: 1px solid #E5E7EB;
    border-radius: 6px;
    font-size: 14px;
  }
  .filter-form button {
    padding: 8px 14px;
    border-radius: 6px;
    font-weight: 600;
    background: #0A1F44;
    color: #fff;
    border: none;
    cursor: pointer;
  }
  .filter-form button:hover {
    background: #14356b;
  }

  .invoice-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 14px;
    min-width: 700px;
  }

  .invoice-table thead tr {
    background-color: #0A1F44;
    color: #fff;
    position: sticky;
    top: 0;
    z-index: 2;
  }

  .invoice-table th {
    padding: 12px;
    text-align: left;
    font-weight: 600;
  }

  .invoice-table td {
    padding: 10px;
    vertical-align: middle;
    transition: background 0.2s ease, box-shadow 0.2s ease;
  }

  .invoice-table tbody tr:hover {
    background-color: #eef2f9;
    box-shadow: inset 0 0 8px rgba(0,0,0,0.08);
  }

  .invoice-table td:nth-child(4),
  .invoice-table th:nth-child(4) {
    text-align: right;
  }

  .invoice-table td:nth-child(5),
  .invoice-table th:nth-child(5),
  .invoice-table td:nth-child(6),
  .invoice-table th:nth-child(6) {
    text-align: center;
  }

  .row-white { background-color: #ffffff; }
  .row-gray { background-color: #f9f9f9; }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
  }
  .paid { background-color: #d4f4dd; color: #1a7f37; }
  .unpaid { background-color: #fddede; color: #c62828; }
  .pay-later { background-color: #fff3cd; color: #b8860b; }

  .action-view,
  .action-delete,
  .action-paid {
    padding: 6px 12px;
    border-radius: 6px;
    font-weight: bold;
    text-decoration: none;
    font-size: 13px;
    transition: all 0.2s ease;
  }
  .action-view { background-color: #0A1F44; color: #fff; }
  .action-delete { background-color: #c62828; color: #fff; margin-left: 6px; }
  .action-paid { background-color: #166534; color: #fff; margin-left: 6px; }
  .action-view:hover { background-color: #14356b; transform: scale(1.05); }
  .action-delete:hover { background-color: #a31515; transform: scale(1.05); }
  .action-paid:hover { background-color: #0f3d1f; transform: scale(1.05); }

  @media (max-width: 768px) {
    .invoice-table, .invoice-table thead, .invoice-table tbody, .invoice-table th, .invoice-table td, .invoice-table tr {
      display: block;
      width: 100%;
    }
    .invoice-table thead { display: none; }
    .invoice-table tr {
      margin-bottom: 15px;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      padding: 10px;
    }
    .invoice-table td {
      text-align: left !important;
      padding: 6px 0;
    }
    .invoice-table td::before {
      content: attr(data-label);
      font-weight: bold;
      color: #0A1F44;
      display: block;
    }
  }
</style>

<div class="card">

    <form method="get" class="filter-form">
    <select name="status">
      <option value="ALL" {% if status == "ALL" %}selected{% endif %}>All Status</option>
      <option value="PAID" {% if status == "PAID" %}selected{% endif %}>Paid</option>
      <option value="UNPAID" {% if status == "UNPAID" %}selected{% endif %}>Unpaid</option>
      <option value="PAY_LATER" {% if status == "PAY_LATER" %}selected{% endif %}>Pay Later</option>
    </select>

    <select name="mode">
      <option value="ALL" {% if mode == "ALL" %}selected{% endif %}>All Modes</option>
      <option value="CASH" {% if mode == "CASH" %}selected{% endif %}>Cash</option>
      <option value="UPI" {% if mode == "UPI" %}selected{% endif %}>UPI</option>
    </select>

    <input type="date" name="from_date" value="{{ from_date }}">
    <input type="date" name="to_date" value="{{ to_date }}">
    <input type="text" name="customer" placeholder="Customer name" value="{{ customer }}">

    <button type="submit">Filter</button>
  </form>

  <form method="post" action="{% url 'bulk_delete_bills' %}">
    {% csrf_token %}
    <table class="invoice-table">
      <thead>
        <tr>
          <th><input type="checkbox" id="select-all"></th>
          <th>Bill</th>
          <th>Customer</th>
          <th>Date</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for bill in bills %}
        <tr class="{% cycle 'row-white' 'row-gray' %}">
          <td><input type="checkbox" name="bill_ids" value="{{ bill.id }}"></td>
          <td data-label="Bill">{{ bill.bill_number }}</td>
          <td data-label="Customer">{{ bill.customer_name|default:"Walk-in" }}</td>
          <td data-label="Date">{{ bill.created_at|date:"d M Y" }}</td>
          <td data-label="Amount">₹{{ bill.total_amount }}</td>
          <td data-label="Status">
            <span class="status-badge {% if bill.payment_status == 'PAID' %}paid{% elif bill.payment_status == 'UNPAID' %}unpaid{% else %}pay-later{% endif %}">
              {% if bill.payment_status == 'PAID' %}✓{% elif bill.payment_status == 'UNPAID' %}✕{% else %}⏳{% endif %}
              {{ bill.payment_status }}
              {% if bill.payment %} ({{ bill.payment.method }}) {% endif %}
            </span>
          </td>
          <td data-label="Actions">
            <a href="{% url 'bill_detail' bill.id %}" class="action-view">View</a>
            {% if bill.payment_status != "PAID" %}
              <a href="{% url 'mark_bill_paid' bill.id %}" class="action-paid">Mark as Paid</a>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" style="padding:12px; text-align:center; color:#555;">No bills</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <button type="submit" class="action-delete" onclick="return confirm('Delete selected bills?')">
      Delete Selected
    </button>
  </form>
</div>

<script>
  document.getElementById("select-all").addEventListener("change", function(e) {
    const checkboxes = document.querySelectorAll("input[name='bill_ids']");
    checkboxes.forEach(cb => cb.checked = e.target.checked);
  });
</script>

{% endblock %}
