{% extends "base.html" %}
{% block title %}Bill {{ bill.bill_number }} | BizSight{% endblock %}
{% block navbar %}
  {% include "partials/navbar.html" %}
{% endblock %}

{% block content %}

<div style="max-width:900px; margin:auto;">

  <div class="card header-card">
    <div>
      <h2 class="biz-name">{{ business.name }}</h2>
      <p class="bill-meta">
        Bill No: <strong>{{ bill.bill_number }}</strong><br>
        Date: {{ bill.created_at|date:"d M Y, h:i A" }}
      </p>
    </div>
    <div>
      <span class="status-badge {{ bill.payment_status|lower }}">
        {{ bill.payment_status|title }}
      </span>
    </div>
  </div>

  <div class="card">
    <h3>Customer Details</h3>
    <p><strong>Name:</strong> {{ bill.customer_name|default:"Walk-in Customer" }}</p>
    {% if bill.customer_phone %}<p><strong>Phone:</strong> {{ bill.customer_phone }}</p>{% endif %}
    {% if bill.customer_email %}<p><strong>Email:</strong> {{ bill.customer_email }}</p>{% endif %}
    {% if bill.customer_address %}<p><strong>Address:</strong><br>{{ bill.customer_address|linebreaksbr }}</p>{% endif %}
  </div>

  <div class="card">
    <h3>Items</h3>
    <table class="invoice-table">
      <thead>
        <tr>
          <th>Item</th>
          <th width="80">Qty</th>
          <th width="120">Price (₹)</th>
          <th width="120">Total (₹)</th>
        </tr>
      </thead>
      <tbody>
        {% for item in bill.items.all %}
        <tr>
          <td>{{ item.item_name }}</td>
          <td>{{ item.quantity }}</td>
          <td class="text-right">{{ item.price }}</td>
          <td class="text-right">{{ item.total }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3>Summary</h3>
    <div class="row"><span>Subtotal</span><span>₹{{ bill.subtotal }}</span></div>
    <div class="row"><span>Discount</span><span>- ₹{{ bill.discount }}</span></div>
    <hr>
    <div class="row total"><strong>Total</strong><strong>₹{{ bill.total_amount }}</strong></div>
  </div>

{% if bill.payment_status == "PAID" %}
  {% if bill.payment.method == "UPI" %}
    <div class="card payment-card">
      <h3>Payment Completed</h3>
      <p class="hint">This bill was settled via UPI.</p>
    </div>
  {% elif bill.payment.method == "CASH" %}
    <div class="card payment-card">
      <h3>Payment Completed</h3>
      <p class="hint">This bill was settled in cash.</p>
    </div>
  {% else %}
    <div class="card payment-card">
      <h3>Payment Completed</h3>
      <p class="hint">This bill has been paid.</p>
    </div>
  {% endif %}
{% else %}
<div class="card payment-card">
  <h3>UPI Payment</h3>

  {% if qr_url %}
    <img src="{{ qr_url }}" alt="UPI QR" class="qr-img">
    <p class="hint">Scan to pay using any UPI app</p>
  {% else %}
    <div class="alert alert-warning">
      UPI not configured. Please add your UPI ID in Business Settings.
    </div>
  {% endif %}

</div>

{% endif %}


  <div class="actions">
    <a href="{% url 'dashboard' %}" class="btn btn-secondary">← Back to Dashboard</a>
    <div>
      <a href="{% url 'download_bill_pdf' bill.id %}" class="btn btn-primary">Download PDF</a>
      {% if bill.email_required %}
        <button class="btn btn-secondary" disabled>Email Bill (Coming Soon)</button>
      {% endif %}
    </div>
  </div>

</div>

<style>
.card {
  background:#fff;
  border:1px solid #E5E7EB;
  border-radius:10px;
  padding:18px;
  margin-bottom:20px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}
.header-card { display:flex; justify-content:space-between; align-items:center; }
.biz-name { margin:0; color:#0A1F44; }
.bill-meta { color:#6B7280; margin-top:4px; font-size:14px; }
.invoice-table { width:100%; border-collapse:collapse; margin-top:10px; }
.invoice-table th { background:#0A1F44; color:#fff; padding:10px; text-align:left; }
.invoice-table td { border:1px solid #E5E7EB; padding:8px; }
.text-right { text-align:right; }
.row { display:flex; justify-content:space-between; margin:6px 0; }
.row.total { font-size:18px; color:#0A1F44; }
.status-badge { padding:6px 12px; border-radius:999px; font-size:14px; font-weight:600; }
.status-badge.paid { background:#DCFCE7; color:#166534; }
.status-badge.unpaid { background:#FEE2E2; color:#991B1B; }
.status-badge.pay_later { background:#FEF9C3; color:#854D0E; }
.payment-card { text-align:center; }
.qr-img { max-width:220px; margin:12px 0; border:1px solid #ddd; border-radius:8px; padding:6px; background:#fff; }
.hint { color:#6B7280; font-size:13px; }
.actions { display:flex; justify-content:space-between; align-items:center; margin-top:20px; }
.btn { padding:8px 14px; border-radius:6px; font-weight:600; text-decoration:none; }
.btn-primary { background:#0A1F44; color:#fff; }
.btn-primary:hover { background:#14356b; }
.btn-secondary { background:#e6ecf5; color:#0A1F44; }
.btn-secondary:hover { background:#d0d7e6; }
</style>

{% endblock %}
