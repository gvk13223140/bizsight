{% extends "bizmitra/base_bizmitra.html" %}
{% block bizmitra_content %}

<div class="bizmitra-container">

  <div class="header">
    <h1 class="title">BizMitra</h1>
    <p class="subtitle">
      Your intelligent business companion — ask why things happen and what to do next.
    </p>
  </div>

  <div class="chat-window" id="chatWindow">

    <div class="message bot">Hello {{ business.name }}.</div>
    <div class="message bot">I’m BizMitra, your decision-support companion.</div>
    <div class="message bot">I analyze patterns in your billing behaviour.</div>
    <div class="message bot">I focus on risks, opportunities, and next actions.</div>

    {% if user_query %}
      <div class="message user">
        {{ user_query }}
      </div>
    {% endif %}

    {% if response %}
      <div class="message bot">
        {{ response }}
      </div>
    {% elif user_query %}
      <div class="message bot thinking">
        Analyzing your business patterns…
      </div>
    {% endif %}

  </div>

  <div class="suggested-questions">
    <p class="suggested-title">Try asking:</p>
    <div class="question-grid">
      <button onclick="fillAndSubmit('What is my biggest business risk right now?')">Biggest risk</button>
      <button onclick="fillAndSubmit('Why are unpaid bills risky for my business?')">Unpaid risk</button>
      <button onclick="fillAndSubmit('What should I focus on improving this week?')">This week</button>
      <button onclick="fillAndSubmit('How can I improve cash flow without increasing sales?')">Cash flow</button>
      <button onclick="fillAndSubmit('What patterns do you see in my billing behaviour?')">Patterns</button>
      <button onclick="fillAndSubmit('What decisions should I avoid right now?')">Avoid mistakes</button>
      <button onclick="fillAndSubmit('If sales stay the same, what happens next?')">What-if analysis</button>
    </div>
  </div>

  <!-- INPUT -->
  <form method="post" class="chat-input">
    {% csrf_token %}
    <input
      type="text"
      name="query"
      placeholder="Ask BizMitra about risk, growth, or decisions…"
      required
      autocomplete="off"
    />
    <button type="submit">Send</button>
  </form>

</div>

<!-- STYLES -->
<style>
.bizmitra-container {
  max-width: 900px;
  margin: auto;
}

/* Header */
.header {
  margin-bottom: 24px;
}
.title {
  font-size: 30px;
  font-weight: 700;
}
.subtitle {
  font-size: 14px;
  color: #6B7280;
}

/* Chat Window */
.chat-window {
  background: #ffffff;
  border-radius: 16px;
  padding: 18px;
  height: 420px;
  overflow-y: auto;
  box-shadow: 0 10px 28px rgba(10,31,68,0.08);
  margin-bottom: 18px;
}

/* Messages */
.message {
  max-width: 75%;
  padding: 10px 14px;
  margin-bottom: 12px;
  border-radius: 14px;
  font-size: 14px;
  line-height: 1.5;
}

.message.bot {
  background: #F1F5F9;
  color: #0A1F44;
}

.message.user {
  background: #0A1F44;
  color: #ffffff;
  margin-left: auto;
}

.message.thinking {
  opacity: 0.7;
  font-style: italic;
}

/* Suggested questions */
.suggested-questions {
  margin-bottom: 14px;
}
.suggested-title {
  font-size: 13px;
  color: #6B7280;
  margin-bottom: 8px;
}
.question-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.question-grid button {
  background: #F9F6F1;
  border: 1px solid #E5E7EB;
  border-radius: 999px;
  padding: 6px 12px;
  font-size: 13px;
  cursor: pointer;
}
.question-grid button:hover {
  background: #EEF2FF;
}

/* Input */
.chat-input {
  display: flex;
  gap: 10px;
}
.chat-input input {
  flex: 1;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #D1D5DB;
}
.chat-input button {
  background: #0A1F44;
  color: #fff;
  border: none;
  border-radius: 12px;
  padding: 0 18px;
  font-weight: 600;
}
</style>

<script>
function fillAndSubmit(text) {
  const input = document.querySelector('input[name="query"]');
  input.value = text;
  input.form.submit();
}
</script>

{% endblock %}

